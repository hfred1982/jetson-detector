events {
    worker_connections  1024;
}

# RTMP configuration
rtmp {
    server {
        listen 1935; # Listen on standard RTMP port
        chunk_size 4000;

        application show {
            live on;
            # Turn on HLS
            hls on;

            hls_path /mnt/hls/;
            hls_fragment 3;
            hls_playlist_length 60;
            #hls_sync 100ms;
        }
    }
}

http {
   # default_type application/octet-stream;
    sendfile off;
	 push_stream_shared_memory_size                100m;


    server {
        listen 8080;

        root /mnt;
        location /hls {
            # Disable cache
            add_header 'Cache-Control' 'no-cache';

            types {
                application/dash+xml mpd;
                application/vnd.apple.mpegurl m3u8;
                video/mp2t ts;
            }

        }
        location /tv {

        }
    location /pub {
        # activate publisher (admin) mode for this location
        push_stream_publisher admin;

        # query string based channel id
        push_stream_channels_path               $arg_id;
    }

    location ~ /ev/(.*) {
        # activate event source mode for this location
        push_stream_subscriber eventsource;

        # positional channel path
        push_stream_channels_path                   $1;
        # message template
        push_stream_message_template                "{\"id\":~id~,\"channel\":\"~channel~\",\"text\":\"~text~\"}";

        # ping frequency
        push_stream_ping_message_interval           10s;
    }

    }
}
